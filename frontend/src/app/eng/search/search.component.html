<div class="margin" *ngFor="let e of config.search_params">
  <div *ngIf="e.text">
    <mat-form-field style="width: 100%">
      <mat-label>{{e.label | t}}</mat-label>
      <input matInput [(ngModel)]="params[e.field]" [type]="e.type" placeholder="{{e.text | t}}"
        (ngModelChange)="resetOffset()" (keyup.enter)="search_clicked()">
    </mat-form-field>
  </div>
  <div *ngIf="e.checkbox">
    <mat-checkbox *ngFor="let c of e.checkbox" (change)="setValue( $event ,c.value, e.field )" class="format checkbox">
      {{c.label | t}}</mat-checkbox>
  </div>
  <div *ngIf="e.autocomplete">
    <app-autocomplete  [config]="e.autocomplete.config" [(input)]="params[e.autocomplete.field]"  ></app-autocomplete>
  </div>
  <div *ngIf="e.single_checkbox">
    <mat-checkbox [(ngModel)]="params[e.field]" class="format checkbox">{{e.single_checkbox.label | t}}</mat-checkbox>
  </div>
  <div *ngIf="e.select">
    <mat-form-field appearance="fill" style="width: 100%;">
      <mat-label>{{e.label | t}}</mat-label>
      <mat-select multiple [(ngModel)]="params[e.field]">
        <mat-option *ngFor="let s of e.select" [value]="s.value"> <img *ngIf="s.image" alt="logo"
            style="height: 2em;margin: auto;position: absolute;top:10%;transform: translateY (-50%);" [src]="s.image">
          &nbsp;
          <span style="margin-left:3em">
            {{s.label | t}}
          </span>
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div *ngIf="e.date">
    <mat-form-field color="primary" appearance="fill" style="width: 100%;" >
      <mat-label>{{e.label | t}}</mat-label>
      <mat-date-range-input [rangePicker]="picker">
        <input (click)="picker.open()" [(ngModel)]="params[e.date.start]" matStartDate
          placeholder="{{'start_date' | t}}">
        <input (click)="picker.open()" [(ngModel)]="params[e.date.end]" (ngModelChange)="format_date(e.date.end)" matEndDate placeholder="{{'end_date' | t}}">
      </mat-date-range-input>
      <div matSuffix style="display: flex;">
        <mat-datepicker-toggle [for]="picker"></mat-datepicker-toggle>
        <mat-icon class="pointer" style="margin: auto;margin-left: 1em;" (click)="resetDate(e.date)">clear</mat-icon>
      </div>

      <mat-date-range-picker touchUi #picker></mat-date-range-picker>
    </mat-form-field>
  </div>
</div>

<div class="double-line-container margin" style="margin-bottom: 1em;">
  <button mat-flat-button *ngIf="config.search_params.length>0" color="primary"
    class="{{export ? 'double-line-button-left' : 'single-line-button'}} darker-primary-bg"
    (click)="search_clicked()">{{"search" | t}}&nbsp;&nbsp; <mat-icon>search</mat-icon></button>
  <button mat-flat-button *ngIf="export" color="accent"
    class="{{config.search_params.length>0 ? 'double-line-button-right' : 'single-line-button'}}"
    (click)="export_as_excel()">
    {{"export" | t}}&nbsp;&nbsp; <mat-icon>save_alt</mat-icon></button>
</div>


<table mat-table aria-describedby="table" [dataSource]="list" matSort (matSortChange)="sort($event)"
  style="width: 100%;">
  <ng-container *ngFor="let e of config.table_fields" [matColumnDef]="e.label">
    <th mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="!e.sortable" class="{{e.classes}}">
      {{e.label | t}} </th>
    <td mat-cell *matCellDef="let element"
      class="{{e.classes}} {{ config.color_class ? config.color_class(element) : e.classes }}">
      <span *ngIf="!e.actions">{{e.render? e.render(element) : element[e.field]}}</span>
      <img alt="logo" *ngIf="e.image" [src]="e.image(element)" style="height: 48px;margin-top: 0.5em;">
      <mat-icon *ngIf="e.icon">{{e.icon(element)}}</mat-icon>
      <div (click)="$event.stopPropagation();">
        <mat-checkbox *ngIf="e.checkbox" [checked]="element.selected" (change)="e.checkbox(element)"></mat-checkbox>
        <mat-slide-toggle *ngIf="e.toggle" [checked]="element.selected" (change)="e.toggle(element)"></mat-slide-toggle>
      </div>
      <div *ngFor="let action of e.actions">

        <button *ngIf="action.condition && action.condition(element)" mat-flat-button [color]="action.color"
          class="{{action.classes}}" [disabled]="action.disable" (click)="action.action(element); $event.stopPropagation() ">
          <mat-icon *ngIf="action.icon" class={{action.classes}}>
            {{action.icon}}
          </mat-icon>
          <span class={{action.classes}}>{{action.title | t}}</span>
        </button>
      </div>

    </td>
  </ng-container>


  <tr mat-header-row *matHeaderRowDef="table_fields()"></tr>
  <tr mat-row *matRowDef="let row; columns: table_fields()" [class.pointer]="navigate" (click)="doNavigate(row)"></tr>
  <tr class="mat-row" *matNoDataRow>
    <td class="mat-cell" colspan="20" style="text-align: center;">{{"no_data_found" | t}}</td>
  </tr>
</table>

<mat-paginator [length]="list[0]?.record_count" *ngIf="list && list[0]?.record_count>0 "
  [pageSize]="common_params.limit" [hidePageSize]="true" [pageIndex]="common_params.offset/common_params.limit"
  (page)="pageChanged(($event))"></mat-paginator>

<button *ngIf="show_add" mat-fab style="position: fixed; right: 1em; bottom: 1em;" color="accent" (click)="add_item()">
  <mat-icon>add</mat-icon>
</button>
